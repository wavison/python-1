import os
import re
import pandas as pd

# Path to folder containing OAP analysis txt files
folder = "_OAP_analysis"

# Regex to capture parameter name and AVERAGE value
param_re = re.compile(r"^(.*?)\s*\nMINIMUM\s*=\s*[\d\.\-Ee+]+\s*\nAVERAGE\s*=\s*([\d\.\-Ee+]+)", re.MULTILINE)

# Store results
rows = []
all_params = set()

for fname in os.listdir(folder):
    if fname.lower().endswith(".txt"):
        fpath = os.path.join(folder, fname)
        with open(fpath, "r", encoding="utf-8") as f:
            content = f.read()

        # Extract parameter name and average
        matches = param_re.findall(content)
        row = {"File": fname}
        for param, avg in matches:
            param_clean = param.strip()
            try:
                avg_val = float(avg)
            except:
                avg_val = None
            row[param_clean] = avg_val
            all_params.add(param_clean)

        rows.append(row)

# Create DataFrame with all possible parameters as columns
df = pd.DataFrame(rows)
# Ensure all parameter columns are present even if missing in some files
df = df[["File"] + sorted(all_params)]

# Save to CSV
output_csv = "OAP_analysis_overview.csv"
df.to_csv(output_csv, index=False)

print(f"Saved overview to {output_csv}")
