import pandas as pd
import matplotlib.pyplot as plt
import re

# === Load the CSV overview ===
csv_path = "OAP_analysis_overview.csv"  # path to your CSV file
df = pd.read_csv(csv_path)

# Column containing the values to plot
param_col = "AVERAGE POWER PER ORBIT [W]"

# Files to plot (in order)
files_plot = [
    "orbit_500_ltan_10_output_fault_1_VELOCITY_NADIR_output.txt",
    "orbit_500_ltan_10_output_fault_2_VELOCITY_NADIR_output.txt",
    "orbit_500_ltan_10_output_plus10_VELOCITY_NADIR_output.txt",
]

# Helper to make nice labels
pat = re.compile(r"orbit_(\d+)_ltan_(\d+)_output_(.+?)_output\.txt")
def friendly_label(fname: str) -> str:
    m = pat.match(fname)
    if not m:
        return fname
    alt, ltan, middle = m.groups()
    return f"{alt} km LTAN {ltan} — {middle.replace('_', ' ')}"

# Filter and order the data
sub = df[df["File"].isin(files_plot)].copy()
sub["order"] = sub["File"].apply(lambda f: files_plot.index(f))
sub.sort_values("order", inplace=True)

# Labels and values for plotting
labels = [friendly_label(f) for f in sub["File"]]
values = sub[param_col].astype(float).tolist()

# === Plot ===
plt.figure(figsize=(8, 5))
plt.bar(range(len(values)), values, color="#aec7e8", edgecolor="black")
plt.xticks(range(len(labels)), labels, rotation=30, ha="right")
plt.ylabel(param_col)
plt.title("Average Power per Orbit — LTAN 10 (Faults vs plus10, Velocity-Nadir)")
plt.grid(axis="y", linestyle="--", alpha=0.7)
plt.tight_layout()

# Save to PNG
out_path = "plot1_ltan10_faults_vs_plus10_only.png"
plt.savefig(out_path, dpi=300)
plt.close()

print(f"Saved plot to {out_path}")
