import pandas as pd
import os

# === CONFIGURATION ===
input_csv = "data_budget_plots/scenario_totals_MB.csv"
symbol_rate = 30  # Msps
spectral_eff = 3.33  # 16APSK 5/6
rs_eff = 223 / 255
crc_eff = 0.956
total_eff = rs_eff * crc_eff
net_rate = symbol_rate * spectral_eff * total_eff  # Mbps

pass_duration_min = 10
pass_duration_s = pass_duration_min * 60
passes_available = [1, 2, 3, 4]  # Number of passes over the period
days = [2, 3, 4, 5]

output_folder = "data_budget_plots"
output_csv = os.path.join(output_folder, "multi_day_download_feasibility.csv")
os.makedirs(output_folder, exist_ok=True)

# === LOAD DATA ===
df = pd.read_csv(input_csv)

# === PROCESS EACH COMBINATION ===
records = []
for _, row in df.iterrows():
    scenario = row["Scenario"]
    daily_mb = row["Total_Daily_MB"]
    for day_count in days:
        required_mb = daily_mb * day_count
        for num_passes in passes_available:
            total_available = net_rate * pass_duration_s * num_passes / 8  # Convert to MB
            pct_transferred = min(100.0, (total_available / required_mb) * 100)
            records.append({
                "Scenario": scenario,
                "Days": day_count,
                "Passes": num_passes,
                "Required_MB": round(required_mb, 1),
                "Available_MB": round(total_available, 1),
                "%_Transferred": round(pct_transferred, 1)
            })

# === OUTPUT RESULTS ===
df_multi = pd.DataFrame(records)
df_multi.to_csv(output_csv, index=False)
print(f"âœ… Multi-day feasibility table saved to: {output_csv}")
